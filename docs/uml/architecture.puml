@startuml
title Allion AI - Detailed Architecture

' Components
rectangle "n8n Orchestration" as N8N
rectangle "LiveKit\n(Real-time Audio/Video)" as LiveKit
rectangle "STT Service\n(Sarvam/Bhashini)" as STT
rectangle "TTS Service\n(Sarvam/Bhashini)" as TTS
rectangle "smolVLM" as VLM
rectangle "Agentic LLM" as LLM
database "Bosch Database" as BoschDB
database "Open Source Data\n(Google / YouTube)" as OSData
rectangle "Workshop UI\n(Web/Mobile)" as UI

' External systems
rectangle "Customer" as Customer
rectangle "Job Card API" as JobCardAPI
rectangle "Inventory API" as InventoryAPI
rectangle "WhatsApp API" as WhatsApp
rectangle "Email Service" as Email

' Connections
Customer --> LiveKit : Speech / Video
LiveKit --> STT : Audio Stream
STT --> N8N : Text (Multilingual)

UI --> N8N : Chat / Images
UI --> LiveKit : Audio Channel
UI --> JobCardAPI : Job Card Create/Update

N8N --> VLM : Image Analysis
N8N --> LLM : Text Prompt / Context
LLM --> BoschDB : Query
LLM --> OSData : Query
LLM --> InventoryAPI : Check / Order

LLM --> N8N : Response / Action
N8N --> TTS : Text to Speech
TTS --> LiveKit : Audio Out

N8N --> JobCardAPI : Populate Job Card

' New communication flows
N8N --> WhatsApp : Initial Report & Estimate\nProgress Updates\nFinal Delivery Report
N8N --> Email : Initial Report & Estimate\nProgress Updates\nFinal Delivery Report
WhatsApp --> Customer
Email --> Customer

@enduml